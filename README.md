# Competition Manger

A first draft for the implementation for the final competition in the autonomous driving internship (PAF).

## Installation

[[Installation]]

## How to save locations

[[How_to_save_locations]]

## Start

### start carla server
   - `cd ~/carla0.9.10.1`
   - `./CarlaUE4.sh`

### load town

```python
import carla
client = carla.Client('localhost', 2000)
client.set_timeout(10.0) # seconds
world = client.load_world('Town05')
```

### source workspace

`source ~/catkin_ws/devel/setup.bash`

### start ego vehicle
   - `roslaunch carla_ros_bridge carla_ros_bridge_with_example_ego_vehicle.launch vehicle_filter:=model3`
1. load start and goal yaml file to rosparam
   - [how to load a yaml file](config/How_to_load_yaml.md)
   - `rosparam load config/Town05/town05_sg2.yaml`
2. start set_position server
   - `rosrun paf_competition_manager set_position_server.py`
3. request setting position
   - `rosrun paf_competition_manager set_position_client.py`
4. `rosrun paf_competition_manager simple_competition_manager.py`
5. spawn npcs

```shell
cd carla0.9.10.1/PythonAPI/examples/
python spawn_npc.py -n 50 -w 50 -s 256
```

9. `rosparam set /competition/traffic_rules false`
10. `rosparam set /competition/ready_for_ego true`

## manual position set

```shell
rostopic pub /carla/ego_vehicle/initialpose geometry_msgs/PoseWithCovarianceStamped "header:
  seq: 0
  stamp:
    secs: 0
    nsecs: 0
  frame_id: ''
pose:
  pose:
    position: {x: 154.44, y: -30.51, z: 0.0}
    orientation: {x: 0.0, y: 0.0, z: 0.0, w: 0.0}
  covariance: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0]" -1
```

## TODO

- create roslaunch file for which loads params and start position server
- improve spawn_npc such that the seed is deterministic

[//begin]: # "Autogenerated link references for markdown compatibility"
[Installation]: docs/Installation.md "Installation"
[How_to_save_locations]: docs/How_to_save_locations.md "How to save locations"
[//end]: # "Autogenerated link references"